!function t(e,n,o){function i(a,r){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!r&&l)return l(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return i(n?n:t)},c,c.exports,t,e,n,o)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),s=t("eventemitter2"),a=function(){function t(e){o(this,t),this.port=e,this.closed=!1,this.emitter=new s.EventEmitter2,e.addEventListener("message",this.handleMessage.bind(this)),e.start()}return i(t,[{key:"handleMessage",value:function(t){var e=t.data[0]||null;if(e){var n=t.data[1]||null;this.emitter.emit(e,n)}}},{key:"on",value:function(t,e){return this.emitter.on(t,e.bind(this)),this}},{key:"off",value:function(t,e){return this.emitter.off(t,e),this}},{key:"emit",value:function(t,e){this.port.postMessage([t,e])}},{key:"close",value:function(){this.port.close(),this.closed=!0}}]),t}();e.exports=a},{eventemitter2:"eventemitter2"}],2:[function(require,module,exports){(function(global){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function isEncoded(t){return"string"==typeof t&&decodeURIComponent(t)!==t}function encodeUrl(t){var e=document.createElement("a");return e.href=t,e.pathname=encodeURIComponent(e.pathname).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%2F/g,"/"),e.href}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),emoticons=require("../emoticons/emoticons.js"),$=require("jquery"),_=require("lodash"),emotify=emoticons.emotify,escape=emoticons.escape,splitText=function(t,e,n){var o=[],i=function a(t,i){if(e[i]&&t.trim().length)if(t.indexOf(e[i])>-1){var s=1,r=t.split(e[i]);r.forEach(function(t){if(t.length){var l="";s!=r.length&&(l=e[i]),t=(t+l).trim()}t.length&&t.length<=n?o.push(t):a(t,i+1),s++})}else a(t,i+1);else if(t.length)for(var l=new RegExp(".{1,"+n+"}","g"),u=t.match(l);u.length>0;)o.push(u.shift().trim())};i(t,0);var s=[];return o.forEach(function(t){s.length&&s[s.length-1].length+t.length+1<=n?s[s.length-1]+=" "+t:s.push(t)}),s},parseBoolean=function(t){var e=Boolean(t);return e&&(e=!!$.parseJSON(String(t).toLowerCase())),e},flashSupport=navigator.mimeTypes&&navigator.mimeTypes.length?Array.prototype.slice.call(navigator.mimeTypes).some(function(t){return"application/x-shockwave-flash"==t.type}):/MSIE/.test(navigator.userAgent)?eval("try { new ActiveXObject('ShockwaveFlash.ShockwaveFlash') && !0 } catch(e) { !1 };"):!1,html5AudioSupport=function(){var t=document.createElement("audio");return!(!t.canPlayType||!t.canPlayType("audio/mpeg;").replace(/no/,""))}(),playSounds=function(t){},AlertBox=function(){function t(e,n){_classCallCheck(this,t);var o=this;this.token=n.token,this.twitchToken=n.twitchToken,this.username=n.username,this.$el=$(e),this.$el.addClass("widget-AlertBox"),this.$el.append($('<div id="alert-box" />').append($('<div id="wrap" />').append($('<div id="alert-image-wrap" />').append('<div id="alert-image"></div>')).append($('<div id="alert-text-wrap" />').append($('<div id="alert-text" />').append($('<div id="alert-message" />')).append($('<div id="alert-user-message" />')))))),this.ab=new AlertBoxWidget(this.$el),this.delay=null,this.globalLayout=null,this.types=null,this.followAlertQueue=[],this.subscriptionAlertQueue=[],this.donationAlertQueue=[],this.hostAlertQueue=[],this.customAlertQueue=[],this.streamStartedAt=null,this.largestDonationThisStream=null,this.enabled={follows:!0,subscriptions:!0,donations:!0,hosts:!0},this.donationPageSettings={};var i=location.search?location.search.slice(1).split("&").reduce(function(t,e){return e=e.split("="),t[e[0]]=e[1]?decodeURIComponent(e[1]):null,t},{}):{},s=require("../taclient.js")(this.token,this.twitchToken,this.username);(i.follows||i.subscriptions||i.donations||i.hosts)&&(this.enabled={follows:parseBoolean(i.follows),subscriptions:parseBoolean(i.subscriptions),donations:parseBoolean(i.donations),hosts:parseBoolean(i.hosts)});var a="/api/v1.0/donation-page/settings?token="+this.token;a=/\.dev$/.test(window.location.hostname)?window.location.href.replace(window.location.pathname,"")+a:"https://www.twitchalerts.com"+a,$.getJSON(a).done(function(t){this.donationPageSettings=t}.bind(this));var r={url:"/vendor/scottschiller/SoundManager2/swf/",onready:function(){playSounds=function(t){soundManager.stopAll(),function e(t){var n=t.shift();if(n){soundManager.createSound({volume:n.volume,url:n.url,autoLoad:!0,autoPlay:!1,onfinish:function(){t.length&&e(t)},onload:function(o){o?n.maxDuration&&this.durationEstimate>n.maxDuration?t.length&&e(t):this.play():(window.onerror("audio failed to load: "+n.url),t.length&&e(t))}})}}(t)}}};html5AudioSupport||(r.flashVersion=9,r.preferFlash=!0),soundManager.setup(r),global.localforage.getItem("streamStartedAt",function(t,e){this.streamStartedAt=e}.bind(this)),global.localforage.getItem("largestDonationThisStream",function(t,e){this.largestDonationThisStream=e}.bind(this)),s.on("streamStats",function(t){t.started_at!=this.streamStartedAt&&(null!=this.streamStartedAt&&(this.largestDonationThisStream=null),this.streamStartedAt=t.started_at,global.localforage.setItem("streamStartedAt",this.streamStartedAt))}.bind(this));var a="/api/v1.0/widgets/alert-box/settings?token="+this.token;a=/\.dev$/.test(window.location.hostname)?window.location.href.replace(window.location.pathname,"")+a:"https://www.twitchalerts.com"+a,$.getJSON(a).done(function(t){o.setSettings(t)}),function(){var t=function e(){var t=100;o.customAlertQueue.length?t=o.showCustomAlert(o.customAlertQueue.shift()):o.donationAlertQueue.length?t=o.showDonationAlert(o.donationAlertQueue.shift()):o.subscriptionAlertQueue.length?t=o.showSubscriptionAlert(o.subscriptionAlertQueue.shift()):o.hostAlertQueue.length?t=o.showHostAlert(o.hostAlertQueue.shift()):o.followAlertQueue.length&&(t=o.showFollowAlert(o.followAlertQueue.shift())),setTimeout(e,t)};t()}();var l=function(){var t=[],e=function(){t=t.slice(0,25e3)};return{contains:function(e){return-1!=t.indexOf(e)},add:function(n){t.unshift(n),e()}}}();s.on("follows",function(t){console.log("new follows: %s",t.map(function(t){return t.name}).join(", "));for(var e=0;e<t.length;e++){var n=t[e];if(o.enabled.follows&&!_.isUndefined(n.variation))o.showFollowAlert({name:n.name,variation:n.variation});else{var i="follow-"+n.name;l.contains(i)||(o.queueAlert("follow",{name:n.name,variation:n.variation}),l.add(i))}}}),s.on("subscriptions",function(t){console.log("new subscriptions: %s",t.map(function(t){return t.name}).join(", "));for(var e=0;e<t.length;e++){var n=t[e],i=n.months||n.count||1;if(o.enabled.subscriptions&&!_.isUndefined(n.variation))o.showSubscriptionAlert({name:n.name,months:i,count:i,variation:n.variation});else{var s="subscription-"+n.name;l.contains(s)||(o.queueAlert("subscription",{name:n.name,months:i,count:i,variation:n.variation}),l.add(s))}}}),s.on("hosts",function(t){console.log("new hosts: %s",t.map(function(t){return t.name}).join(", "));for(var e=0;e<t.length;e++){var n=t[e],i=n.viewers||n.count||0;if(o.enabled.hosts&&!_.isUndefined(n.variation))o.showHostAlert({name:n.name,viewers:i,count:i,variation:n.variation});else{var s="host-"+n.name;l.contains(s)||(o.queueAlert("host",{name:n.name,viewers:i,count:i,variation:n.variation}),l.add(s))}}}),s.on("alerts",function(t){for(var e=0;e<t.length;e++){var n=t[e];o.queueAlert("custom",n)}}),s.on("donations",function(t){console.log("new donations: %s",t.map(function(t){return t.name+" ("+t.formattedAmount+")"}).join(", "));for(var e=0;e<t.length;e++){var n=t[e];".00"==n.formattedAmount.slice(-3)&&(n.formattedAmount=n.formattedAmount.slice(0,-3)),o.enabled.donations&&!_.isUndefined(n.variation)?o.showDonationAlert({name:n.name,amount:n.amount,message:n.message,formattedAmount:n.formattedAmount,variation:n.variation,emotes:n.emotes}):o.queueAlert("donation",{name:n.name,amount:n.amount,message:n.message,formattedAmount:n.formattedAmount,variation:n.variation,emotes:n.emotes})}}),s.on("alertBoxSettings",function(t){o.setSettings(t)}),s.on("donationPageSettings",function(t){o.donationPageSettings=t})}return _createClass(t,[{key:"setSettings",value:function(t){var e=this;global.name&&$(function(){e.$el.css({background:t.background_color})}),this.globalLayout=t.layout,this.delay=parseInt(t.alert_delay),this.types={follow:{settings:{layout:t.follow_layout||this.globalLayout,imageHref:t.follow_image_href,soundHref:t.follow_sound_href,soundVolume:t.follow_sound_volume,textSize:t.follow_font_size,textColor:t.follow_font_color,specialTextColor:t.follow_font_color2,textAnimation:t.follow_text_animation,font:t.follow_font,textThickness:t.follow_font_weight,messageTemplate:t.follow_message_template,showAnimation:t.follow_show_animation,hideAnimation:t.follow_hide_animation},variations:t.follow_variations,duration:parseInt(t.follow_alert_duration),enabled:parseBoolean(t.follow_enabled)},host:{settings:{layout:t.host_layout||this.globalLayout,imageHref:t.host_image_href,soundHref:t.host_sound_href,soundVolume:t.host_sound_volume,textSize:t.host_font_size,textColor:t.host_font_color,specialTextColor:t.host_font_color2,textAnimation:t.host_text_animation,font:t.host_font,textThickness:t.host_font_weight,messageTemplate:t.host_message_template,showAnimation:t.host_show_animation,hideAnimation:t.host_hide_animation},variations:t.host_variations,duration:parseInt(t.host_alert_duration),enabled:parseBoolean(t.host_enabled),viewerMinimum:parseInt(t.host_viewer_minimum||0)},donation:{settings:{layout:t.donation_layout||this.globalLayout,imageHref:t.donation_image_href,soundHref:t.donation_sound_href,soundVolume:t.donation_sound_volume,textSize:t.donation_font_size,textColor:t.donation_font_color,specialTextColor:t.donation_font_color2,textAnimation:t.donation_text_animation,font:t.donation_font,textThickness:t.donation_font_weight,messageTemplate:t.donation_message_template,userMessageTextThickness:t.donation_message_font_weight,userMessageTextSize:t.donation_message_font_size,userMessageTextColor:t.donation_message_font_color,userMessageFont:t.donation_message_font,userMessageEnabled:parseBoolean(t.show_donation_message),userMessageAllowEmotes:parseBoolean(t.donation_message_allow_emotes),ttsLanguage:t.donation_tts_language,ttsEnabled:parseBoolean(t.donation_tts_enabled),ttsSecurity:parseInt(t.donation_tts_security||0),ttsVolume:parseInt(t.donation_tts_volume||75),minAmount:parseFloat(t.donation_alert_min_amount),messageMinAmount:parseFloat(t.donation_alert_message_min_amount),ttsMinAmount:parseFloat(t.donation_tts_min_amount),showAnimation:t.donation_show_animation,hideAnimation:t.donation_hide_animation},variations:t.donation_variations,duration:parseInt(t.donation_alert_duration),enabled:parseBoolean(t.donation_enabled)},subscription:{settings:{layout:t.sub_layout||this.globalLayout,imageHref:t.sub_image_href,soundHref:t.sub_sound_href,soundVolume:t.sub_sound_volume,textSize:t.sub_font_size,textColor:t.sub_font_color,specialTextColor:t.sub_font_color2,textAnimation:t.sub_text_animation,font:t.sub_font,textThickness:t.sub_font_weight,messageTemplate:t.sub_message_template,showAnimation:t.sub_show_animation,hideAnimation:t.sub_hide_animation},variations:t.sub_variations,duration:parseInt(t.sub_alert_duration),enabled:parseBoolean(t.sub_enabled)}}}},{key:"queueAlert",value:function(t,e){"follow"==t?this.enabled.follows&&this.followAlertQueue.push(e):"subscription"==t?this.enabled.subscriptions&&this.subscriptionAlertQueue.push(e):"donation"==t?this.enabled.donations&&this.donationAlertQueue.push(e):"host"==t?this.enabled.hosts&&this.hostAlertQueue.push(e):"custom"==t?e.type&&this.enabled[e.type+"s"]&&this.customAlertQueue.push(e):console.log("invalid alert type")}},{key:"showFollowAlert",value:function(t){var e=t,n=_.cloneDeep(this.types.follow),o=n.settings.layout||this.globalLayout;if(n.enabled){if(n.variations&&n.variations.length){var i=[];if(_.isUndefined(e.variation)||_.isNull(e.variation)?_.forEach(n.variations,function(t,e){"RANDOM"==t.condition&&i.push(t)}):n.variations[e.variation]&&i.push(n.variations[e.variation]),i.length){var s=_.sample(i);n.settings.imageHref=s.settings.image.href,n.settings.soundHref=s.settings.sound.href,n.settings.messageTemplate=s.settings.text.format,n.settings.soundVolume=s.settings.sound.volume||n.settings.soundVolume,n.settings.textSize=s.settings.text.size||n.settings.textSize,n.settings.textColor=s.settings.text.color||n.settings.textColor,n.settings.specialTextColor=s.settings.text.color2||n.settings.specialTextColor,n.settings.textAnimation=_.isUndefined(s.settings.text.animation)?n.settings.textAnimation:s.settings.text.animation,n.settings.font=s.settings.text.font||n.settings.font,n.settings.textThickness=s.settings.text.thickness||n.settings.textThickness,n.duration=s.settings.duration||n.duration,n.settings.showAnimation=s.settings.showAnimation||n.settings.showAnimation,n.settings.hideAnimation=s.settings.hideAnimation||n.settings.hideAnimation,o=s.settings.layout||o}}return this.showAlert(n.settings,e,n.duration,o),this.delay+n.duration}}},{key:"showSubscriptionAlert",value:function(t){var e=t,n=_.cloneDeep(this.types.subscription),o=n.settings.layout||this.globalLayout;if(n.enabled){if(n.variations&&n.variations.length){var i=[];if(_.isUndefined(e.variation)||_.isNull(e.variation)){var s=0;_.forEach(n.variations,function(t,n){"MIN_MONTHS_SUBSCRIBED"==t.condition?(t.conditionData=parseInt(t.conditionData),e.count>=t.conditionData&&t.conditionData>=s&&(t.conditionData>s&&(i=[]),i.push(t),s=t.conditionData)):"RANDOM"==t.condition&&0==s&&i.push(t)})}else n.variations[e.variation]&&i.push(n.variations[e.variation]);if(i.length){var a=_.sample(i);n.settings.imageHref=a.settings.image.href,n.settings.soundHref=a.settings.sound.href,n.settings.messageTemplate=a.settings.text.format,n.settings.soundVolume=a.settings.sound.volume||n.settings.soundVolume,n.settings.textSize=a.settings.text.size||n.settings.textSize,n.settings.textColor=a.settings.text.color||n.settings.textColor,n.settings.specialTextColor=a.settings.text.color2||n.settings.specialTextColor,n.settings.textAnimation=_.isUndefined(a.settings.text.animation)?n.settings.textAnimation:a.settings.text.animation,n.settings.font=a.settings.text.font||n.settings.font,n.settings.textThickness=a.settings.text.thickness||n.settings.textThickness,n.duration=a.settings.duration||n.duration,n.settings.showAnimation=a.settings.showAnimation||n.settings.showAnimation,n.settings.hideAnimation=a.settings.hideAnimation||n.settings.hideAnimation,o=a.settings.layout||o}}return this.showAlert(n.settings,e,n.duration,o),this.delay+n.duration}}},{key:"showDonationAlert",value:function(t){var e=this.largestDonationThisStream,n=this.donationPageSettings,o=t,i=_.cloneDeep(this.types.donation),s=i.settings.layout||this.globalLayout;if(o.amount=parseFloat(o.amount),i.enabled&&i.settings.minAmount<=parseFloat(o.amount)){i.settings.messageMinAmount>parseFloat(o.amount)&&(o.message=""),i.settings.ttsMinAmount>parseFloat(o.amount)&&(i.settings.ttsEnabled=!1);var a=this.profanitize(o.message,o.name);if(o.message=a.message,o.name=a.name,4!=n.profanity_mode||!a.profanity){var r=i.settings;if(r.emotes=t.emotes,a.profanity&&1==n.profanity_mode&&(r.ttsEnabled=!1),o.rawAmount=o.amount,o.amount=o.formattedAmount,delete o.formattedAmount,i.variations&&i.variations.length){var l=[];if(_.isUndefined(o.variation)||_.isNull(o.variation)){var u=0,c=0,a={LARGEST_OF_STREAM:10,EXACT_DONATION_AMOUNT:20,MIN_DONATION_AMOUNT:5};_.forEach(i.variations,function(t,n){"LARGEST_OF_STREAM"==t.condition&&c<=a.LARGEST_OF_STREAM?(!e||o.rawAmount>e)&&(c<a.LARGEST_OF_STREAM&&(c=a.LARGEST_OF_STREAM,l=[]),l.push(t)):"EXACT_DONATION_AMOUNT"==t.condition&&c<=a.EXACT_DONATION_AMOUNT?(t.conditionData=parseFloat(t.conditionData),o.rawAmount==t.conditionData&&(c<a.EXACT_DONATION_AMOUNT&&(c=a.EXACT_DONATION_AMOUNT,u=0),t.conditionData>=u&&(t.conditionData>u&&(l=[]),l.push(t),u=t.conditionData))):"MIN_DONATION_AMOUNT"==t.condition&&c<=a.MIN_DONATION_AMOUNT?(t.conditionData=parseFloat(t.conditionData),o.rawAmount>=t.conditionData&&t.conditionData>=u&&(t.conditionData>u&&(l=[]),l.push(t),u=t.conditionData)):"RANDOM"==t.condition&&0==u&&l.push(t)}),(!e||o.rawAmount>e)&&(this.largestDonationThisStream=e=o.rawAmount,global.localforage.setItem("largestDonationThisStream",e))}else i.variations[o.variation]&&l.push(i.variations[o.variation]);if(l.length){var h=_.sample(l);i.settings.imageHref=h.settings.image.href,i.settings.soundHref=h.settings.sound.href,i.settings.messageTemplate=h.settings.text.format,i.settings.soundVolume=h.settings.sound.volume||i.settings.soundVolume,i.settings.textSize=h.settings.text.size||i.settings.textSize,i.settings.textColor=h.settings.text.color||i.settings.textColor,i.settings.specialTextColor=h.settings.text.color2||i.settings.specialTextColor,i.settings.textAnimation=_.isUndefined(h.settings.text.animation)?i.settings.textAnimation:h.settings.text.animation,i.settings.font=h.settings.text.font||i.settings.font,i.settings.textThickness=h.settings.text.thickness||i.settings.textThickness,i.duration=h.settings.duration||i.duration,i.settings.showAnimation=h.settings.showAnimation||i.settings.showAnimation,i.settings.hideAnimation=h.settings.hideAnimation||i.settings.hideAnimation,s=h.settings.layout||s}}return this.showAlert(r,o,i.duration,s),this.delay+i.duration}}}},{key:"showHostAlert",value:function(t){var e=t,n=_.cloneDeep(this.types.host),o=n.settings.layout||this.globalLayout;if(n.enabled&&n.viewerMinimum<=parseInt(e.viewers)){if(n.variations&&n.variations.length){var i=[];if(_.isUndefined(e.variation)||_.isNull(e.variation)){var s=0;_.forEach(n.variations,function(t,n){"MIN_VIEWERS_ACQUIRED"==t.condition?(t.conditionData=parseInt(t.conditionData),e.viewers>=t.conditionData&&t.conditionData>=s&&(t.conditionData>s&&(i=[]),i.push(t),s=t.conditionData)):"RANDOM"==t.condition&&0==s&&i.push(t)})}else n.variations[e.variation]&&i.push(n.variations[e.variation]);if(i.length){var a=_.sample(i);n.settings.imageHref=a.settings.image.href,n.settings.soundHref=a.settings.sound.href,n.settings.messageTemplate=a.settings.text.format,n.settings.soundVolume=a.settings.sound.volume||n.settings.soundVolume,n.settings.textSize=a.settings.text.size||n.settings.textSize,n.settings.textColor=a.settings.text.color||n.settings.textColor,n.settings.specialTextColor=a.settings.text.color2||n.settings.specialTextColor,n.settings.textAnimation=_.isUndefined(a.settings.text.animation)?n.settings.textAnimation:a.settings.text.animation,n.settings.font=a.settings.text.font||n.settings.font,n.settings.textThickness=a.settings.text.thickness||n.settings.textThickness,n.duration=a.settings.duration||n.duration,n.settings.showAnimation=a.settings.showAnimation||n.settings.showAnimation,n.settings.hideAnimation=a.settings.hideAnimation||n.settings.hideAnimation,o=a.settings.layout||o}}return e.count=parseInt(e.viewers),this.showAlert(n.settings,e,n.duration,o),this.delay+n.duration}}},{key:"showCustomAlert",value:function(t){var e=_.cloneDeep(this.types[t.type]),n=e.settings.layout||this.globalLayout,o=t.duration||e.duration,i=e.settings;_.has(t,"image_href")&&(i.imageHref=t.image_href),_.has(t,"sound_href")&&(i.soundHref=t.sound_href),_.has(t,"special_text_color")&&(i.specialTextColor=t.special_text_color);var s={},a=t.message||"",r=new RegExp("\\*(.*?)\\*","g"),l=a.match(r);if(l)for(var u=0;u<l.length;u++)a=a.replace(l[u],"{token"+u+"}"),s["token"+u]=l[u].slice(1,-1);return i.messageTemplate=a,this.showAlert(i,s,o,n),this.delay+o}},{key:"showAlert",value:function(){this.ab.showAlert.apply(this.ab,arguments)}},{key:"profanitize",value:function(t,e){var n=this.donationPageSettings,o=global.Profanity,i=n.profanity_custom_words.trim(),s=i.length?i.replace(/\s\s+/g," ").split(" "):[],a=s.length?o.getListRegex(s):null,r=!1;if(n.profanity_names&&o.testString(e,{extraRegex:a,useDefaultRegex:n.profanity_default_words})&&(e="Anonymous"),1==n.profanity_mode){var l=o.purifyString(t,{extraRegex:a,useDefaultRegex:n.profanity_default_words,replace:!1});t=l[0],r=l[1].length>0}else if(2==n.profanity_mode){var l=o.purifyString(t,{extraRegex:a,useDefaultRegex:n.profanity_default_words,replace:!0});t=l[0],r=l[1].length>0}else if(3==n.profanity_mode||4==n.profanity_mode){var l=o.purifyString(t,{extraRegex:a,useDefaultRegex:n.profanity_default_words,replace:!1});l[1].length&&(t="",r=!0)}return{profanity:r,message:t,name:e}}}]),t}(),AlertBoxWidget=function(){function t(e){_classCallCheck(this,t),this.settings={messageTemplate:"{name} is now following!",font:"Open Sans",textSize:"64px",textThickness:"800",textColor:"#FFFFFF",specialTextColor:"#32C3A6",textAnimation:"wiggle"},this.$el=e,this.timeout=null,this.$el.addClass("hidden")}return _createClass(t,[{key:"setImageHref",value:function(t){isEncoded(t)||(t=encodeUrl(t));var e=this.$el.find("#alert-image");e.empty().css("background-image","none"),t&&(/\.webm$/.test(t)?this.$el.find("#alert-image").append('<video autoplay loop src="'+t+'" />'):(e.html('<img style="opacity: 0; height: 1px; width: 1px;" />').find("img").each(function(){this.offsetHeight}).prop("src",t),e.css("background-image","url("+t+")")))}},{key:"setSoundHref",value:function(t){this.settings.soundHref=t}},{key:"setSoundVolume",value:function(t){this.settings.soundVolume=t}},{key:"setTextSize",value:function(t){this.$el.find("#alert-message").css({fontSize:t})}},{key:"setTextColor",value:function(t){this.$el.find("#alert-message").css({color:t})}},{key:"setSpecialTextColor",value:function(t){this.settings.specialTextColor=t,this.$el.find("#alert-message span").css({color:t})}},{key:"setTextAnimation",value:function(t){this.settings.textAnimation=t,this.$el.find("#alert-message span span").each(function(){$(this).removeClass().addClass("animated-letter "+t)})}},{key:"setTextThickness",value:function(t){this.$el.find("#alert-message").css({fontWeight:t})}},{key:"setFont",value:function(t){WebFont.load({google:{families:[t+":300,400,600,700,800,900"]}}),this.$el.find("#alert-message").css({fontFamily:'"'+t+'"'})}},{key:"setMessageTemplate",value:function(t,e){for(var n in e){var o=new RegExp("{"+n+"}","g");t=t.replace(o,"<span>"+e[n]+"</span>")}this.$el.find("#alert-message").html(t),this.$el.find("#alert-message > span").each(function(){var t=$(this).text().split("");$(this).html($.map(t,function(t){return" "==t&&(t="&nbsp;"),"<span>"+t+"</span>"}).join(""))}),this.setTextAnimation(this.settings.textAnimation),this.setSpecialTextColor(this.settings.specialTextColor)}},{key:"setUserMessage",value:function(t){this.$el.find("#alert-user-message").html(t)}},{key:"setUserMessageTextThickness",value:function(t){this.$el.find("#alert-user-message").css({fontWeight:t})}},{key:"setUserMessageFont",value:function(t){WebFont.load({google:{families:[t+":300,400,600,700,800,900"]}}),this.$el.find("#alert-user-message").css({fontFamily:'"'+t+'"'})}},{key:"setUserMessageTextColor",value:function(t){this.$el.find("#alert-user-message").css({color:t})}},{key:"setUserMessageTextSize",value:function(t){this.$el.find("#alert-user-message").css({fontSize:t})}},{key:"showAlert",value:function(t,e,n,o){this.$el.attr("data-layout",o),this.timeout&&clearTimeout(this.timeout);var i=Math.min(100,Math.max(0,t.soundVolume||50)),s=Math.min(100,Math.max(0,t.ttsVolume||75)),a=[];t.soundHref&&a.push({url:t.soundHref,volume:i});var r=this.$el;if(this.setImageHref(t.imageHref),this.setSoundHref(t.soundHref),this.setSoundVolume(t.soundVolume),this.setTextSize(t.textSize),this.setTextColor(t.textColor),this.setSpecialTextColor(t.specialTextColor),this.setTextAnimation(t.textAnimation),this.setFont(t.font),this.setTextThickness(t.textThickness),this.setMessageTemplate(t.messageTemplate,e),e.message){var l=e.message,u=e.message;if(this.setUserMessageTextThickness(t.userMessageTextThickness),this.setUserMessageTextSize(t.userMessageTextSize),this.setUserMessageTextColor(t.userMessageTextColor),this.setUserMessageFont(t.userMessageFont),t.userMessageEnabled?(u=t.emotes&&t.userMessageAllowEmotes?emotify(u,t.emotes,function(t){return['<img src="',t.replace("1.0","3.0"),'" />'].join("")}):escape(u),this.setUserMessage(u)):this.setUserMessage(""),t.ttsEnabled){l=l.replace(/((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(\/\S*)?)/gi,"");for(var c=t.ttsLanguage||"en",h=splitText(l,[".","!","?",":",";",","," "],90),f=0;f<h.length;f++){var m=h[f].length,d={url:"http://translate.google.com/translate_tts?ie=UTF-8&total=1&idx=0&textlen="+m+"&client=tw-ob&q="+encodeURIComponent(h[f])+"&tl="+c,volume:s};1==t.ttsSecurity?d.maxDuration=11e3:2==t.ttsSecurity?d.maxDuration=8500:3==t.ttsSecurity&&(d.maxDuration=6250),a.push(d)}}}else this.setUserMessage("");r.removeClass("hidden").addClass("animated "+t.showAnimation).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated "+t.showAnimation)}),a.length&&i>0&&playSounds(a),this.timeout=setTimeout(function(){r.addClass("animated "+t.hideAnimation).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).addClass("hidden").removeClass("animated "+t.hideAnimation)})},n)}}]),t}();global.AlertBox=module.exports=AlertBox}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../emoticons/emoticons.js":4,"../taclient.js":6,jquery:"jquery",lodash:"lodash"}],3:[function(t,e,n){(function(n){"use strict";var o=n.location.hostname&&-1!==n.location.hostname.indexOf("twitchalerts.dev"),i=o?"http://io.twitchalerts.dev:4567":"http://io.twitchalerts.com:4567",s=t("./ircclient.js"),a=t("socket.io-client"),r=t("moment"),l=t("es6-promise").Promise,u=t("eventemitter2"),c=new u.EventEmitter2;l.prototype.always=function(t){return this.then(t,function(e){throw t(e),e})},l.prototype["finally"]=function(t){return this["catch"](function(t){return t}).then(t)};var h=function(e){if("undefined"==typeof importScripts){var n=t("jquery");return new l(function(t,o){n.ajax(e,{dataType:"jsonp"}).done(function(e){e.error?o(e):t(e)}).error(function(t){o(t)})})}return new l(function(t,n){var o="script"+Math.floor(1e16*Math.random());self[o]=function(e){e.error?n(e):t(e)},e+=(-1!=e.indexOf("?")?"&":"?")+"callback="+o,importScripts(e)})};e.exports=function(t){var e={subscriptions:null,follows:null},n={follows:[],subscriptions:[],hosts:{}},o=function(){var n=null,o=3e5,i=!0,s=function u(){var i="https://api.twitch.tv/kraken/streams/"+t.username;h(i).then(function(t){if(t.stream){var n={viewers:t.stream.viewers,game:t.stream.game,started_at:r(t.stream.created_at).utc().format("YYYY-MM-DD HH:mm:ss")};e.follows&&(n.follows=e.follows),e.subscriptions&&(n.subscriptions=e.subscriptions),m.emit("streamStats",n)}}).always(function(){n=setTimeout(u,o)})},a=function(){i=!0,l(),n=setTimeout(s,5e3)},l=function(){i=!0,n&&clearTimeout(n)};return{start:a,stop:l}}(),l=function(){var o=null,i=2e4,s=!0,a=function c(){var a="https://api.twitch.tv/kraken/channels/"+t.username+"/follows?limit=25&direction=desc";h(a).then(function(t){if(t.follows&&t.follows.length){for(var o=[],i=0;i<t.follows.length;i++){var a=t.follows[i];-1==n.follows.indexOf(a.user._id)&&(o.push({created_at:r(a.created_at).utc().format("YYYY-MM-DD HH:mm:ss"),id:a.user._id,name:a.user.display_name}),n.follows.push(a.user._id))}o.length&&(s||(m.emit("follows",o),console.log("emitting %s follows",o.length))),e.follows=t._total}s=!1}).always(function(){o=setTimeout(c,i)})},l=function(){s=!0,u(),o=setTimeout(a,5e3)},u=function(){s=!0,o&&clearTimeout(o)};return{start:l,stop:u}}(),u=function(){var o=null,i=2e4,s=!0,a=function c(){var a="https://api.twitch.tv/kraken/channels/"+t.username+"/subscriptions?oauth_token="+t.twitchToken+"&limit=25&direction=desc";h(a).then(function(t){if(t.subscriptions){if(t.subscriptions.length){for(var o=[],a=0;a<t.subscriptions.length;a++){var l=t.subscriptions[a];-1==n.subscriptions.indexOf(l.user._id)&&(o.push({created_at:r(l.created_at).utc().format("YYYY-MM-DD HH:mm:ss"),id:l.user._id,name:l.user.display_name}),n.subscriptions.push(l.user._id))}o.length&&(s||(m.emit("subscriptions",o),console.log("emitting %s subscriptions",o.length))),e.subscriptions=t._total}i=3e4}s=!1})["catch"](function(t){i=3e5}).then(function(){o=setTimeout(c,i)})},l=function(){s=!0,u(),o=setTimeout(a,5e3)},u=function(){s=!0,o&&clearTimeout(o)};return{start:l,stop:u}}(),f=function(){var t=null,e=/([a-zA-Z0-9-_]+) (?:is now hosting you)(?: for ([0-9]+) viewers?)?\./;return{start:function(n,o){if(!t){n=n.toLowerCase();var i=n,a="https://api.twitch.tv/api/channels/"+i+"/chat_properties";h(a).then(function(a){var r="ws://"+a.web_socket_servers[Math.floor(Math.random()*a.web_socket_servers.length)],l=n,u="oauth:"+o;t=new s(r),t.on("connected",function(){this.send("CAP REQ :twitch.tv/tags twitch.tv/commands"),this.send("PASS "+u),this.send("NICK "+l),this.send("JOIN #"+i)}).on("message",function(t){if(c.emit("twitch.irc",t),"PRIVMSG"==t.command){var n=(t.prefix.split("!")[0]||"").toLowerCase();if("jtv"==n){var o=t.crlf.match(e);if(o){var i=o[2]||0,s=o[1]||null;if(s){var a=[{name:s,viewers:i}];console.log("emitting %s hosts",a.length),m.emit("hosts",a)}}}}}),t.connect()})}}}}(),m=a(i,{reconnectionDelay:1e4,reconnectionDelayMax:1e4,reconnectionAttempts:10,timeout:5e3});return m.on("error",function(t){console.log("error")}),m.on("disconnect",function(t){console.log("disconnect")}),m.on("reconnecting",function(t){console.log("reconnecting %d",t)}),m.on("reconnect_failed",function(t){console.log("reconnect_failed")}),m.on("connect",function(){console.log("connected, subscribing"),m.emit("subscribe",t.token),f.start(t.username,t.twitchToken)}),m.on("promote",function(){console.log("----- PROMOTED! -----"),l.start(),u.start(),o.start()}),{on:function(t,e){"twitch.irc"==t?c.on(t,e):m.on(t,e)}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ircclient.js":5,"es6-promise":"es6-promise",eventemitter2:"eventemitter2",jquery:"jquery",moment:"moment","socket.io-client":"socket.io-client"}],4:[function(t,e,n){"use strict";var o=window.jQuery,i=window._,s=function(){function t(t,e){return['<span class="emote" style="background-image: url(',t,');"><img src="',t,'" /></span>'].join("")}function e(e,n,o){var o=o||t,i=[],s=[];n=n.length?n.split("/"):[];var r,l,u=e.length;return n.forEach(function(t){r=t.slice(0,t.indexOf(":")),l=t.substring(t.indexOf(":")+1).split(","),l.forEach(function(t){t=t.split("-"),i.push({start:parseInt(t[0]),end:parseInt(t[1]),id:r})})}),i=i.sort(function(t,e){return e.start-t.start}),i.forEach(function(t){s.push(a(e.slice(t.end+1,u))),s.push(o(["//static-cdn.jtvnw.net/emoticons/v1/",t.id,"/1.0"].join(""),t.id)),u=t.start}),s.push(a(e.slice(0,u))),s.reverse(),s.join("")}var n=null,s={},a=function(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},r=function(t){return t.replace(/([\\])?\((\?\:)?/,function(t,e,n){return e||n?t:"(?:"})},l=function(t){return decodeURI(t).replace("&gt\\;",">").replace("&lt\\;","<").replace(/\(\?![^)]*\)/g,"").replace(/\(([^|])*\|?[^)]*\)/g,"$1").replace(/\[([^|])*\|?[^\]]*\]/g,"$1").replace(/[^\\]\?/g,"").replace(/^\\b|\\b$/g,"").replace(/\\/g,"");

},u=function(){return new Promise(function(t,e){null!=n&&t(n),o.getJSON("https://api.twitch.tv/kraken/chat/emoticon_images").done(function(e){n=i.map(e.emoticons,function(t){return-1!=t.code.indexOf("\\")&&(t.regex=t.code,t.code=l(t.regex)),t.url="//static-cdn.jtvnw.net/emoticons/v1/"+t.id+"/1.0",s[t.code]=t.id,t}),t(n)})})},c=function(){return new Promise(function(t,e){u().then(function(e){t(i.filter(e,function(t){return null==t.emoticon_set}))})})},h=function(t){return s[t]},f=function(){return new Promise(function(t,e){u().then(function(e){t(i.filter(e,function(t){return 457==t.emoticon_set}))})})},m=function(t,n,o){var i={},s=t,a=s.length,l=0,u={};return new Promise(function(c,h){var f={},m=[];o.forEach(function(t){t.regex?m.push(t):f[t.code]=t});for(var d,g="("+m.map(function(t){return r(t.regex)}).join(")|(")+")",p=new RegExp(g,"gi"),v=t.split(" "),_=(t.split(" "),0),w=0,x=v.length;x>w;w++)"undefined"!=typeof f[v[w]]?(l++,n>=l&&(d=f[v[w]],i[d.id]=i[d.id]||[],i[d.id].push(_+"-"+(_+v[w].length-1)),a-=v[w].length-1,u[d.id]=d.code)):v[w].replace(p,function(){for(var t=1;t<arguments.length-2;t++)if(arguments[t]){l++,n>=l&&(d=m[t-1],i[d.id]=i[d.id]||[],i[d.id].push(_+"-"+(_+v[w].length-1)),a-=v[w].length-1,u[d.id]=d.code);break}}),_+=v[w].length+1;var A=[];for(var y in i)A.push(y+":"+i[y].join(","));A=A.join("/"),c({original:s,translation:e(t,A,function(t,e){return['<img class="emoticon" title="',u[e],'" src="',t,'" />'].join("")}),characters:a,count:l,emotes:A})})};return{escape:a,emotify:e,translate:m,getAllEmotes:u,getBasicEmotes:c,regexToCode:l,getTurboEmotes:f,getIdFromCode:h}}();e.exports=s},{}],5:[function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),s=t("lodash"),a=function(t){for(var e={},n=t.split(";"),o=0;o<n.length;o++){var i=n[o].split("=");e[i[0]]=i[1]}return e},r=function(t){return t.split(" ")},l=/^(?:@(\S+) )?(?::(\S+) )?(\S+)(?: ([^:]+))?(?: :(.+))?$/,u=function(){function t(e){o(this,t),this.settings={reconnect:!0},this.lastPingAt=null,this.expectedPingFrequency=6e5,this.pingTimeoutInterval=null,this.url=e,this._events={},this.on("message",function(t){"PING"==t.command&&(this.lastPingAt=Date.now(),this.send("PONG "+t.crlf))}).on("connected",function(){this.lastPingAt=Date.now(),this.pingTimeoutInterval=setInterval(function(){Date.now()-this.expectedPingFrequency>this.lastPingAt&&this.disconnect()}.bind(this),this.expectedPingFrequency)}).on("close",function(){this.pingTimeoutInterval&&clearInterval(this.pingTimeoutInterval)})}return i(t,[{key:"connect",value:function(){if(!this.connection){var t=this;this.connection=new WebSocket(this.url),this.connection.onmessage=function(e){var n=e.data.trim(),o=n.match(l);if(o){var i={raw:n,tags:o[1]?a(o[1]):null,prefix:o[2],command:o[3],params:o[4]?r(o[4]):null,crlf:o[5]};t.emit("message",i)}},this.connection.onerror=function(){t.emit("error")},this.connection.onclose=function(){t.emit("close"),t.settings.reconnect&&setTimeout(function(){t.reconnect()},5e3)},this.connection.onopen=function(){t.emit("connected")}}}},{key:"disconnect",value:function(){this.connection&&(this.connection.close(),this.connection=null)}},{key:"reconnect",value:function(){this.disconnect(),this.connect()}},{key:"send",value:function(t){this.connection.send(t)}},{key:"on",value:function(t,e){return this._events[t]=this._events[t]||[],this._events[t].push(e),this}},{key:"emit",value:function(t){if(s.has(this._events,t)){var e=this,n=Array.prototype.slice.call(arguments,1);s.forEach(this._events[t],function(t){t.apply(e,n)})}}}]),t}();e.exports=u},{lodash:"lodash"}],6:[function(t,e,n){"use strict";var o=t("eventemitter2"),i=t("./WorkerClient.js"),s=new t("ua-parser-js")(),a=function(){console.log("reloading"),window.location.reload(!0)};e.exports=function(e,n,r){var l=!0;if(l&="Chrome"==s.browser.name,l&=parseInt(s.browser.major)>=37,l&="Mac OS"!=s.os.name||parseInt(s.browser.major)>41){var u=parseInt(localStorage.getItem("workerRetries")||0),c=new o.EventEmitter2,h=Date.now(),f=0,m=function(){h=Date.now(),f=0;var t=new SharedWorker(["/dist/worker.min.js?token=",e,"&v=1",u,"&twitchToken=",n,"&username=",r].join("")),o=new i(t.port);return o.on("pong",function(){h=Date.now(),f=0}).on("emit",function(t){var e=t[0],n=t[1];c.emit(e,n)}),o},d=m();return setInterval(function(){d.emit("ping"),Date.now()-h>6e4&&(console.log("pong failed, reload"),localStorage.setItem("workerRetries",u+1),a())},5e3),d.emit("forward","reconnect_failed"),c.on("reconnect_failed",function(){localStorage.setItem("workerRetries",u+1),a()}),d.emit("forward","reload"),c.on("reload",function(){localStorage.setItem("workerRetries",u+1),a()}),{on:function(t,e){d.emit("forward",t),c.on(t,e)}}}var c=t("./client.core.js")({username:r,twitchToken:n,token:e});return c.on("reload",function(){a()}),c.on("reconnect_failed",function(){console.log("reconnect_failed"),a()}),{on:function(t,e){c.on(t,e)}}}},{"./WorkerClient.js":1,"./client.core.js":3,eventemitter2:"eventemitter2"}]},{},[2]);